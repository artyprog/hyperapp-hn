!function(){"use strict";function n(n,e){var o,i=arguments,a=[];for(t=arguments.length;t-- >2;)r.push(i[t]);for(;r.length;)if(Array.isArray(o=r.pop()))for(t=o.length;t--;)r.push(o[t]);else null!=o&&!0!==o&&!1!==o&&("number"==typeof o&&(o+=""),a.push(o));return"string"==typeof n?{tag:n,data:e||{},children:a}:n(e,a)}function e(n,e){for(var t,r,o={},i=0;i<e.length&&!t;i++){var a=e[i][0],l=[];n.replace(RegExp("*"===a?".*":"^"+a.replace(/\//g,"\\/").replace(/:([\w]+)/g,function(n,e){return l.push(e),"([-\\.%\\w\\(\\)]+)"})+"/?$","g"),function(){for(var n=arguments,e=1;e<arguments.length-2;){var c=n[e++];try{c=decodeURI(c)}catch(n){}o[l.shift()]=c}t=a,r=i})}return{match:t,index:r,params:o}}var t,r=[],o=[],i=firebase.database().ref("v0"),a=function(n){return function(e){return n[e]?Promise.resolve(n[e]):i.child("item/"+e).once("value").then(function(n){return n.val()})}},l=function(n){return n.reduce(function(n,e){return Object.assign(n,(t={},t[e.id]=e,t));var t},{})},c=function(n){var e=function(n,e){return n>1?n+" "+e+"s ago":n+" "+e+" ago"},t=Math.floor((new Date).getTime()/1e3-n),r=Math.floor(t/31536e3);return r>=1?e(r,"year"):(r=Math.floor(t/2592e3))>=1?e(r,"month"):(r=Math.floor(t/86400))>=1?e(r,"day"):(r=Math.floor(t/3600))>=1?e(r,"hour"):(r=Math.floor(t/60))>=1?e(r,"minute"):Math.floor(t)<1?"Just Now":e(Math.floor(t),"second")},u=function(n){var e=document.createElement("div");return function(n){return n&&"string"==typeof n&&(n=(n=n.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=n,n=e.textContent,e.textContent=""),n}(n)},s=function(n){return n.text?Object.assign(n,{text:u(n.text)}):n},f=function(e){return n("nav",null,n("wrapper-",null,n("icon-",null,"H"),n("a",{href:"/top"},"Top"),n("a",{href:"/new"},"New"),n("a",{href:"/show"},"Show"),n("a",{href:"/ask"},"Ask"),n("a",{href:"/job"},"Jobs")))},m=function(e){return e.id&&n("li",null,n("score-",null,e.score),n("article",null,n("title-",null,n("a",{href:e.url?e.url:"/item/"+e.id},e.title)),n("meta-",null,n("span",null,"by"),n("a",{href:"/user/"+e.by},e.by),n("time-",null,c(e.time)),n("span",null,"|"),n("a",{href:"/item/"+e.id},e.descendants," comments"))))},d=function(e){return function(t){return t.id&&n("story-",null,n("header",null,n("title-",null,n("a",{href:t.url?t.url:"/item/"+t.id},t.title)),n("meta-",null,n("score-",null,t.score," points"),n("span",null,"|"),n("span",null,"by"),n("a",{href:"/user/"+t.by},t.by),n("time-",null,c(t.time)))),n("comment-list",null,t.kids&&t.kids.map(h(e))))}},h=function(e){return function(t){return e[t]&&n("comment-",null,n("meta-",null,n("a",{href:"/user/"+e[t].by},e[t].by),n("time-",null,c(e[t].time))),n("text-",null,e[t].text),n("kids-",null,e[t].kids&&e[t].kids.map(h(e))))}},p=function(e,t){return n("main",{},[f(),n("ul",{},e.stories.slice(0,20).map(function(n){return e.items[n]||{}}).map(m))])};!function(n,e){if("undefined"==typeof document)return e;n=n||"";var t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}("html {\n  font-size: calc(10px + 2vmin);\n  font-family: sans-serif;\n  background: #f2f2f2;\n}\n\nbody,\n* {\n  line-height: 1.38em;\n  display: block;\n  background: none;\n  box-sizing: border-box;\n  margin: 0;\n  border: 0;\n  padding: 0;\n  outline: 0;\n}\n\nhead,\nstyle,\nscript {\n  display: none;\n}\n\nbody,\nnoscript {\n  height: 100vh;\n  width: 100%;\n  display: flex;\n}\n\nnoscript {\n  width: 100vw;\n  align-items: center;\n  justify-content: center;\n  font-weight: bold;\n}\n\nbutton {\n  margin: auto;\n  padding: 2rem;\n  font-size: 8rem;\n  font-weight: bold;\n  cursor: pointer;\n  touch-action: manipulation;\n  -webkit-tap-highlight-color: rgba(0,0,0,0);\n}\n\nh1 {\n  margin: auto;\n  font-size: 1rem;\n  cursor: pointer;\n  text-decoration: underline;\n}\n\nmain {\n  width: 100%;\n}\n\nnav {\n  width: 100%;\n  padding: 1rem;\n  background: linear-gradient(to bottom, #16e3e7, #0acbff);\n}\n\nnav wrapper- {\n    display: flex;\n    align-items: center;\n    max-width: 70ex;\n    margin: 0 auto;\n  }\n\nnav wrapper- >*+* { margin-left: 1rem; }\n\nnav icon- {\n    width: 2rem;\n    height: 2rem;\n    border: 2px solid #fff;\n    color: #fff;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin-right: auto;\n  }\n\nnav a {\n    color: #fff;\n    font-size: .75rem;\n  }\n\nnav a:not(:hover) { text-decoration: none; }\n\nul {\n  padding: 1rem;\n}\n\nli {\n  display: flex;\n  margin: 0 auto;\n  padding: 1rem 1rem 1rem 0;\n  background: #fff;\n  max-width: 70ex;\n}\n\nli+li { border-top: 1px solid rgba(0,0,0,.1) }\n\nli score- {\n    flex: 4rem 0 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #0acbff;\n    font-weight: bold;\n    font-size: .75rem;\n  }\n\nli article {\n    display: flex;\n    flex-direction: column;\n  }\n\nli meta- {\n    display: flex;\n    font-size: .6rem;\n    margin-top: .25rem;\n  }\n\nli meta- >*+* { margin-left: .5ex; }\n\nli meta-,li meta- a {\n      color: rgba(0,0,0,.5);\n    }\n\nli title- a {\n    text-decoration: none;\n    color: rgba(0,0,0,.75);\n    font-size: .75rem;\n  }\n\ncomment-list {\n  margin: 0 auto;\n  padding: 1rem;\n}\n\nheader {\n  max-width: 70ex;\n  padding: 1rem;\n  background: #fff;\n  margin: 0 auto;\n  margin-top: 1rem;\n}\n\nheader+header { border-top: 1px solid rgba(0,0,0,.1) }\n\nheader title- a {\n    color: rgba(0,0,0,.75);\n    font-size: .75rem;\n    font-weight: bold;\n    text-decoration: none;\n  }\n\nheader meta- {\n    display: flex;\n    margin-top: .5rem;\n    font-size: .6rem;\n  }\n\nheader meta- >*+* { margin-left: .5ex; }\n\nheader meta-,header meta- a { color: rgba(0,0,0,.5); }\n\n\ncomment- {\n  max-width: 70ex;\n  padding: 1rem;\n  background: #fff;\n  margin: 0 auto;\n}\n\n\ncomment-+comment- { border-top: 1px solid rgba(0,0,0,.1) }\n\n\ncomment- kids-:not(:empty) {\n    margin-top: 1rem;\n  }\n\n\ncomment- comment- {\n    padding-right: 0;\n    border-left: 1px solid rgba(0,0,0,.1);\n  }\n\n\ncomment- meta- {\n    display: flex;\n    margin-bottom: .5rem;\n    font-size: .6rem;\n  }\n\n\ncomment- meta- >*+* { margin-left: .5ex; }\n\n\ncomment- meta-,comment- meta- a { color: rgba(0,0,0,.5); }\n\n\ncomment- text- {\n    font-size: .6rem;\n  }\n",void 0),history.replaceState(null,null,sessionStorage.redirect),delete sessionStorage.redirect;var g=window.location.host.startsWith("localhost");"serviceWorker"in navigator&&!g&&navigator.serviceWorker.register("/sw.js"),function(n){function e(n,t,r){Object.keys(t||[]).map(function(o){var l=t[o],c=r?r+"."+o:o;"function"==typeof l?n[o]=function(n){a("action",{name:c,data:n});var e=a("resolve",l(h,y,n));return"function"==typeof e?e(i):i(e)}:e(n[o]||(n[o]={}),l,c)})}function t(n){for(k=d(w,k,p,p=a("render",v)(h,y),g=!g);n=o.pop();)n()}function r(){v&&!g&&requestAnimationFrame(t,g=!g)}function i(n){return n&&(n=a("update",l(h,n)))&&r(h=n),h}function a(n,e){return(b[n]||[]).map(function(n){var t=n(h,y,e);null!=t&&(e=t)}),e}function l(n,e){var t={};for(var r in n)t[r]=n[r];for(var r in e)t[r]=e[r];return t}function c(n){if(n&&(n=n.data))return n.key}function u(n,e){if("string"==typeof n)t=document.createTextNode(n);else{var t=(e=e||"svg"===n.tag)?document.createElementNS("http://www.w3.org/2000/svg",n.tag):document.createElement(n.tag);n.data&&n.data.oncreate&&o.push(function(){n.data.oncreate(t)});for(var r in n.data)s(t,r,n.data[r]);for(r=0;r<n.children.length;)t.appendChild(u(n.children[r++],e))}return t}function s(n,e,t,r){if("key"===e);else if("style"===e)for(var o in l(r,t=t||{}))n.style[o]=t[o]||"";else{try{n[e]=t}catch(n){}"function"!=typeof t&&(t?n.setAttribute(e,t):n.removeAttribute(e))}}function f(n,e,t){for(var r in l(e,t)){var i=t[r],a="value"===r||"checked"===r?n[r]:e[r];i!==a&&s(n,r,i,a)}t&&t.onupdate&&o.push(function(){t.onupdate(n,e)})}function m(n,e,t){t&&t.onremove?t.onremove(e):n.removeChild(e)}function d(n,e,t,r,o,i){if(null==t)e=n.insertBefore(u(r,o),e);else if(null!=r.tag&&r.tag===t.tag){f(e,t.data,r.data),o=o||"svg"===r.tag;for(var a=r.children.length,l=t.children.length,s={},h=[],p={},g=0;g<l;g++)y=h[g]=e.childNodes[g],null!=(S=c(b=t.children[g]))&&(s[S]=[y,b]);for(var g=0,v=0;v<a;){var y=h[g],b=t.children[g],x=r.children[v];if(p[S=c(b)])g++;else{var w=c(x),k=s[w]||[];null==w?(null==S&&(d(e,y,b,x,o),v++),g++):(S===w?(d(e,k[0],k[1],x,o),g++):k[0]?(e.insertBefore(k[0],y),d(e,k[0],k[1],x,o)):d(e,y,null,x,o),v++,p[w]=x)}}for(;g<l;){var S=c(b=t.children[g]);null==S&&m(e,h[g],b.data),g++}for(var g in s){var z=(k=s[g])[1];p[z.data.key]||m(e,k[0],z.data)}}else e&&r!==e.nodeValue&&(e=n.insertBefore(u(r,o),i=e),m(n,i,t.data));return e}for(var h,p,g,v=n.view,y={},b={},x=n.mixins||[],w=n.root||document.body,k=w.children[0],S=0;S<=x.length;S++){var z=x[S]?x[S](a):n;Object.keys(z.events||[]).map(function(n){b[n]=(b[n]||[]).concat(z.events[n])}),e(y,z.actions),h=l(h,z.state)}r((p=a("load",k))===k&&(p=k=null))}({state:{items:{},stories:[],story:{}},actions:{setStories:function(n,e,t){return{stories:t}},setStory:function(n,e,t){return{story:t}},cacheItems:function(n,e,t){return{items:Object.assign(n.items,l(t.map(s)))}},fetchKids:function(n,e,t){return function(r){return t.kids&&Promise.all(t.kids.map(a(n.items))).then(function(n){return n.forEach(e.fetchKids)||n}).then(e.cacheItems)}},fetchStories:function(n,e,t){return function(r){return i.child(t+"stories").once("value").then(function(n){return n.val()}).then(e.setStories).then(function(e){var t=e.stories;return Promise.all(t.map(a(n.items)))}).then(e.cacheItems)}},fetchStory:function(n,e,t){return function(r){return a(n.items)(t).then(e.setStory).then(function(n){return n.story}).then(e.fetchKids)}}},events:{route:[function(n,e,t){"/"===t.match&&e.fetchStories("top")},function(n,e,t){"/:type"===t.match&&e.fetchStories(t.params.type)},function(n,e,t){"/item/:id"===t.match&&e.fetchStory(t.params.id)}]},view:[["/",p],["/:type",p],["/item/:id",function(e,t){return n("main",{},[f(),d(e.items)(e.story)])}],["*",function(e,t){return n("h1",{},n("a",{href:"/"},"Back to "+location.hostname))}]],mixins:[function(n){return{state:{router:{}},actions:{router:{set:function(n,e,t){return{router:t}},go:function(n,e,t){location.pathname+location.search!==t&&(history.pushState({},"",t),e.router.set({path:t}))}}},events:{load:function(n,e){addEventListener("popstate",function(){e.router.set({})})},render:function(t,r,o){return o[(t.router.index>=0?t:r.router.set(n("route",e(location.pathname,o)))).router.index][1]}}}},function(n){return{events:{load:function(n,e){return addEventListener("click",function(n){if(!(n.metaKey||n.shiftKey||n.ctrlKey||n.altKey)){for(var t=n.target;t&&"a"!==t.localName;)t=t.parentNode;t&&t.host===location.host&&!t.hasAttribute("data-no-routing")&&(n.preventDefault(),e.router.go(t.pathname))}})}}}}]})}();
